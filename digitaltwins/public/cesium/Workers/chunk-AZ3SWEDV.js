import{a as e}from"./chunk-CXNPIJLB.js";import{d as t}from"./chunk-BKSIEBAA.js";import{b as i,h as o}from"./chunk-YWRPWWKI.js";import{a as r}from"./chunk-VTVHUB7E.js";import{a as a,b as s,c as n,d as c}from"./chunk-JMSSU44E.js";import{a as l}from"./chunk-4UYSGV57.js";import{a as m}from"./chunk-VLPNAR64.js";import{a as u,b as d}from"./chunk-GE5NEIZC.js";import{e as h}from"./chunk-35CVRQTC.js";function f(e,t){d.typeOf.object("ellipsoid",e),this._ellipsoid=e,this._cameraPosition=new a,this._cameraPositionInScaledSpace=new a,this._distanceToLimbInScaledSpaceSquared=0,h(t)&&(this.cameraPosition=t)}Object.defineProperties(f.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){let t=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),i=a.magnitudeSquared(t)-1;a.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=t,this._distanceToLimbInScaledSpaceSquared=i}}});var p=new a;f.prototype.isPointVisible=function(e){return z(this._ellipsoid.transformPositionToScaledSpace(e,p),this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)},f.prototype.isScaledSpacePointVisible=function(e){return z(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var S=new a;f.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){let i=this._ellipsoid,o,r;return h(t)&&t<0&&i.minimumRadius>-t?((r=S).x=this._cameraPosition.x/(i.radii.x+t),r.y=this._cameraPosition.y/(i.radii.y+t),r.z=this._cameraPosition.z/(i.radii.z+t),o=r.x*r.x+r.y*r.y+r.z*r.z-1):(r=this._cameraPositionInScaledSpace,o=this._distanceToLimbInScaledSpaceSquared),z(e,r,o)},f.prototype.computeHorizonCullingPoint=function(e,t,i){return P(this._ellipsoid,e,t,i)};var g=c.clone(c.UNIT_SPHERE);f.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,i,o){return P(N(this._ellipsoid,i,g),e,t,o)},f.prototype.computeHorizonCullingPointFromVertices=function(e,t,i,o,r){return b(this._ellipsoid,e,t,i,o,r)},f.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,i,o,r,a){return b(N(this._ellipsoid,r,g),e,t,i,o,a)};var x=[];f.prototype.computeHorizonCullingPointFromRectangle=function(e,i,r){d.typeOf.object("rectangle",e);let s=o.subsample(e,i,0,x),n=t.fromPoints(s);if(!(a.magnitude(n.center)<.1*i.minimumRadius))return this.computeHorizonCullingPoint(n.center,s,r)};var y=new a;function N(e,t,i){if(h(t)&&t<0&&e.minimumRadius>-t){let o=a.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,y);e=c.fromCartesian3(o,i)}return e}function P(e,t,i,o){d.typeOf.object("directionToPoint",t),d.defined("positions",i),h(o)||(o=new a);let r=C(e,t),s=0;for(let t=0,o=i.length;t<o;++t){let o=H(e,i[t],r);if(o<0)return;s=Math.max(s,o)}return w(r,s,o)}var T=new a;function b(e,t,i,o,r,s){d.typeOf.object("directionToPoint",t),d.defined("vertices",i),d.typeOf.number("stride",o),h(s)||(s=new a),o=m(o,3),r=m(r,a.ZERO);let n=C(e,t),c=0;for(let t=0,a=i.length;t<a;t+=o){T.x=i[t]+r.x,T.y=i[t+1]+r.y,T.z=i[t+2]+r.z;let o=H(e,T,n);if(o<0)return;c=Math.max(c,o)}return w(n,c,s)}function z(e,t,i){let o=a.subtract(e,t,p),r=-a.dot(o,t);return!(i<0?r>0:r>i&&r*r/a.magnitudeSquared(o)>i)}var _=new a,E=new a;function H(e,t,i){let o=e.transformPositionToScaledSpace(t,_),r=a.magnitudeSquared(o),s=Math.sqrt(r),n=a.divideByScalar(o,s,E);r=Math.max(1,r),s=Math.max(1,s);let c=a.dot(n,i),l=a.magnitude(a.cross(n,i,n)),m=1/s,u=Math.sqrt(r-1)*m;return 1/(c*m-l*u)}function w(e,t,i){if(!(t<=0||t===1/0||t!=t))return a.multiplyByScalar(e,t,i)}var I=new a;function C(e,t){return a.equals(t,a.ZERO)?t:(e.transformPositionToScaledSpace(t,I),a.normalize(I,I))}var v=f,q={};q.getHeight=function(e,t,i){if(!Number.isFinite(t))throw new u("scale must be a finite number.");if(!Number.isFinite(i))throw new u("relativeHeight must be a finite number.");return(e-i)*t+i};var G=new s;q.getPosition=function(e,t,i,o,r){let s=t.cartesianToCartographic(e,G);if(!h(s))return a.clone(e,r);let n=q.getHeight(s.height,i,o);return a.fromRadians(s.longitude,s.latitude,n,t,r)};var O=Object.freeze({NONE:0,BITS12:1}),V=new a,B=new a,M=new n,A=new i,R=new i;function j(e,t,o,r,s,n,c,l,u,d){let f=O.NONE,p,S;if(h(t)&&h(o)&&h(r)&&h(s)){let e=t.minimum,n=t.maximum,c=a.subtract(n,e,B),l=r-o;f=4095>Math.max(a.maximumComponent(c),l)?O.BITS12:O.NONE,p=i.inverseTransformation(s,new i);let m=a.negate(e,V);i.multiply(i.fromTranslation(m,A),p,p),V.x=1/c.x,V.y=1/c.y,V.z=1/c.z,i.multiply(i.fromScale(V,A),p,p),S=i.clone(s),i.setTranslation(S,a.ZERO,S),s=i.clone(s,new i);let u=i.fromTranslation(e,A),d=i.fromScale(c,R),h=i.multiply(u,d,A);i.multiply(s,h,s),i.multiply(S,h,S)}this.quantization=f,this.minimumHeight=o,this.maximumHeight=r,this.center=a.clone(e),this.toScaledENU=p,this.fromScaledENU=s,this.matrix=S,this.hasVertexNormals=n,this.hasWebMercatorT=m(c,!1),this.hasGeodeticSurfaceNormals=m(l,!1),this.exaggeration=m(u,1),this.exaggerationRelativeHeight=m(d,0),this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}j.prototype.encode=function(t,o,r,s,c,m,u,d){let h=s.x,f=s.y;if(this.quantization===O.BITS12){(r=i.multiplyByPoint(this.toScaledENU,r,V)).x=l.clamp(r.x,0,1),r.y=l.clamp(r.y,0,1),r.z=l.clamp(r.z,0,1);let a=this.maximumHeight-this.minimumHeight,s=l.clamp((c-this.minimumHeight)/a,0,1);n.fromElements(r.x,r.y,M);let m=e.compressTextureCoordinates(M);n.fromElements(r.z,s,M);let d=e.compressTextureCoordinates(M);n.fromElements(h,f,M);let p=e.compressTextureCoordinates(M);if(t[o++]=m,t[o++]=d,t[o++]=p,this.hasWebMercatorT){n.fromElements(u,0,M);let i=e.compressTextureCoordinates(M);t[o++]=i}}else a.subtract(r,this.center,V),t[o++]=V.x,t[o++]=V.y,t[o++]=V.z,t[o++]=c,t[o++]=h,t[o++]=f,this.hasWebMercatorT&&(t[o++]=u);return this.hasVertexNormals&&(t[o++]=e.octPackFloat(m)),this.hasGeodeticSurfaceNormals&&(t[o++]=d.x,t[o++]=d.y,t[o++]=d.z),o};var U=new a,W=new a;j.prototype.addGeodeticSurfaceNormals=function(e,t,i){if(this.hasGeodeticSurfaceNormals)return;let o=this.stride,r=e.length/o;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();let a=this.stride;for(let s=0;s<r;s++){for(let i=0;i<o;i++){let r=s*o+i;t[s*a+i]=e[r]}let r=this.decodePosition(t,s,U),n=i.geodeticSurfaceNormal(r,W),c=s*a+this._offsetGeodeticSurfaceNormal;t[c]=n.x,t[c+1]=n.y,t[c+2]=n.z}},j.prototype.removeGeodeticSurfaceNormals=function(e,t){if(!this.hasGeodeticSurfaceNormals)return;let i=this.stride,o=e.length/i;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();let r=this.stride;for(let a=0;a<o;a++)for(let o=0;o<r;o++){let s=a*i+o;t[a*r+o]=e[s]}},j.prototype.decodePosition=function(t,o,r){if(h(r)||(r=new a),o*=this.stride,this.quantization===O.BITS12){let a=e.decompressTextureCoordinates(t[o],M);r.x=a.x,r.y=a.y;let s=e.decompressTextureCoordinates(t[o+1],M);return r.z=s.x,i.multiplyByPoint(this.fromScaledENU,r,r)}return r.x=t[o],r.y=t[o+1],r.z=t[o+2],a.add(r,this.center,r)},j.prototype.getExaggeratedPosition=function(e,t,i){i=this.decodePosition(e,t,i);let o=this.exaggeration,r=this.exaggerationRelativeHeight;if(1!==o&&this.hasGeodeticSurfaceNormals){let a=this.decodeGeodeticSurfaceNormal(e,t,W),s=this.decodeHeight(e,t),n=q.getHeight(s,o,r)-s;i.x+=a.x*n,i.y+=a.y*n,i.z+=a.z*n}return i},j.prototype.decodeTextureCoordinates=function(t,i,o){return h(o)||(o=new n),i*=this.stride,this.quantization===O.BITS12?e.decompressTextureCoordinates(t[i+2],o):n.fromElements(t[i+4],t[i+5],o)},j.prototype.decodeHeight=function(t,i){return i*=this.stride,this.quantization===O.BITS12?e.decompressTextureCoordinates(t[i+1],M).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:t[i+3]},j.prototype.decodeWebMercatorT=function(t,i){return i*=this.stride,this.quantization===O.BITS12?e.decompressTextureCoordinates(t[i+3],M).x:t[i+6]},j.prototype.getOctEncodedNormal=function(e,t,i){let o=e[t=t*this.stride+this._offsetVertexNormal]/256,r=Math.floor(o);return n.fromElements(r,(o-r)*256,i)},j.prototype.decodeGeodeticSurfaceNormal=function(e,t,i){return i.x=e[t=t*this.stride+this._offsetGeodeticSurfaceNormal],i.y=e[t+1],i.z=e[t+2],i},j.prototype._calculateStrideAndOffsets=function(){let e=0;this.quantization===O.BITS12?e+=3:e+=6,this.hasWebMercatorT&&(e+=1),this.hasVertexNormals&&(this._offsetVertexNormal=e,e+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=e,e+=3),this.stride=e};var k={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},L={compressed0:0,compressed1:1,geodeticSurfaceNormal:2};j.prototype.getAttributes=function(e){let t=r.FLOAT,i=r.getSizeInBytes(t),o=this.stride*i,a=0,s=[];function n(r,n){s.push({index:r,vertexBuffer:e,componentDatatype:t,componentsPerAttribute:n,offsetInBytes:a,strideInBytes:o}),a+=n*i}if(this.quantization===O.NONE){let e;n(k.position3DAndHeight,4),e=2+(+!!this.hasWebMercatorT+ +!!this.hasVertexNormals),n(k.textureCoordAndEncodedNormals,e),this.hasGeodeticSurfaceNormals&&n(k.geodeticSurfaceNormal,3)}else{let e=this.hasWebMercatorT||this.hasVertexNormals,t=this.hasWebMercatorT&&this.hasVertexNormals;n(L.compressed0,e?4:3),t&&n(L.compressed1,1),this.hasGeodeticSurfaceNormals&&n(L.geodeticSurfaceNormal,3)}return s},j.prototype.getAttributeLocations=function(){return this.quantization===O.NONE?k:L},j.clone=function(e,t){if(h(e))return h(t)||(t=new j),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=a.clone(e.center),t.toScaledENU=i.clone(e.toScaledENU),t.fromScaledENU=i.clone(e.fromScaledENU),t.matrix=i.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t.hasGeodeticSurfaceNormals=e.hasGeodeticSurfaceNormals,t.exaggeration=e.exaggeration,t.exaggerationRelativeHeight=e.exaggerationRelativeHeight,t._calculateStrideAndOffsets(),t};var F=j;export{v as a,F as b};