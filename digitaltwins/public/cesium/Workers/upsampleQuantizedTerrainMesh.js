import{a as e,b as t}from"./chunk-AZ3SWEDV.js";import{a as i}from"./chunk-PWAJ3RAI.js";import{a as n}from"./chunk-O3CFQFRB.js";import{a as s}from"./chunk-CXNPIJLB.js";import"./chunk-FNJKWSPR.js";import"./chunk-KSZ5EBRB.js";import"./chunk-V3DSE3OK.js";import"./chunk-FMRIJYNG.js";import{a as r}from"./chunk-NNHN6WUY.js";import{d as h}from"./chunk-BKSIEBAA.js";import{h as u}from"./chunk-YWRPWWKI.js";import"./chunk-VTVHUB7E.js";import{a as o,b as p,c as l,d as f}from"./chunk-JMSSU44E.js";import{a as d}from"./chunk-4UYSGV57.js";import"./chunk-ANLJ4KBN.js";import"./chunk-ID6SFQTL.js";import"./chunk-VLPNAR64.js";import{a as a,b as c}from"./chunk-GE5NEIZC.js";import{e as g}from"./chunk-35CVRQTC.js";var m={};m.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,s,r){let h,u,o;if(!g(e))throw new a("threshold is required.");if(!g(t))throw new a("keepAbove is required.");if(!g(i))throw new a("u0 is required.");if(!g(n))throw new a("u1 is required.");if(!g(s))throw new a("u2 is required.");g(r)?r.length=0:r=[],t?(h=i<e,u=n<e,o=s<e):(h=i>e,u=n>e,o=s>e);let p=h+u+o,l,f,d,c,m,w;return 1===p?h?(l=(e-i)/(n-i),f=(e-i)/(s-i),r.push(1),r.push(2),1!==f&&(r.push(-1),r.push(0),r.push(2),r.push(f)),1!==l&&(r.push(-1),r.push(0),r.push(1),r.push(l))):u?(d=(e-n)/(s-n),c=(e-n)/(i-n),r.push(2),r.push(0),1!==c&&(r.push(-1),r.push(1),r.push(0),r.push(c)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(m=(e-s)/(i-s),w=(e-s)/(n-s),r.push(0),r.push(1),1!==w&&(r.push(-1),r.push(2),r.push(1),r.push(w)),1!==m&&(r.push(-1),r.push(2),r.push(0),r.push(m))):2===p?h||i===e?u||n===e?o||s===e||(f=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(f),r.push(-1),r.push(1),r.push(2),r.push(d)):(w=(e-s)/(n-s),l=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(w),r.push(-1),r.push(0),r.push(1),r.push(l)):(c=(e-n)/(i-n),m=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(c),r.push(-1),r.push(2),r.push(0),r.push(m)):3!==p&&(r.push(0),r.push(1),r.push(2)),r},m.computeBarycentricCoordinates=function(e,t,i,n,s,r,h,u,p){if(!g(e))throw new a("x is required.");if(!g(t))throw new a("y is required.");if(!g(i))throw new a("x1 is required.");if(!g(n))throw new a("y1 is required.");if(!g(s))throw new a("x2 is required.");if(!g(r))throw new a("y2 is required.");if(!g(h))throw new a("x3 is required.");if(!g(u))throw new a("y3 is required.");let l=i-h,f=h-s,d=r-u,c=n-u,m=1/(d*l+f*c),w=t-u,x=e-h,y=(d*x+f*w)*m,B=(-c*x+l*w)*m,I=1-y-B;return g(p)?(p.x=y,p.y=B,p.z=I,p):new o(y,B,I)},m.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,s,r,h,u,o){c.typeOf.number("x00",e),c.typeOf.number("y00",t),c.typeOf.number("x01",i),c.typeOf.number("y01",n),c.typeOf.number("x10",s),c.typeOf.number("y10",r),c.typeOf.number("x11",h),c.typeOf.number("y11",u);let p=(h-s)*(t-r)-(u-r)*(e-s),f=(i-e)*(t-r)-(n-t)*(e-s),d=(u-r)*(i-e)-(h-s)*(n-t);if(0===d)return;let a=p/d,m=f/d;if(a>=0&&a<=1&&m>=0&&m<=1)return g(o)||(o=new l),o.x=e+a*(i-e),o.y=t+a*(n-t),o};var w=[],x=[],y=[],B=new p,I=new o,A=[],v=[],b=[],N=[],k=[],V=new o,j=new h,C=new n,R=new l,z=new o;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return g(e)||(e=new O),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return g(this.index)},O.prototype.getH=function(){return g(this.index)?this.heightBuffer[this.index]:d.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return g(this.index)?this.uBuffer[this.index]:d.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return g(this.index)?this.vBuffer[this.index]:d.lerp(this.first.getV(),this.second.getV(),this.ratio)};var S=new l,T=-1,E=[new o,new o],q=[new o,new o];function F(e,t){let i=E[++T],n=q[T];return i=s.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.octDecode(e.second.getNormalX(),e.second.getNormalY(),n),I=o.lerp(i,n,e.ratio,I),o.normalize(I,I),s.octEncode(I,t),--T,t}O.prototype.getNormalX=function(){return g(this.index)?this.normalBuffer[2*this.index]:(S=F(this,S)).x},O.prototype.getNormalY=function(){return g(this.index)?this.normalBuffer[2*this.index+1]:(S=F(this,S)).y};var H=[];function U(e,t,i,n,s,r,h,u,o){if(0===h.length)return;let p=0,l=0;for(;l<h.length;)l=H[p++].initializeFromClipResult(h,l,u);for(let s=0;s<p;++s){let h=H[s];if(h.isIndexed())h.newIndex=r[h.index],h.uBuffer=e,h.vBuffer=t,h.heightBuffer=i,o&&(h.normalBuffer=n);else{let s=h.getKey();if(g(r[s]))h.newIndex=r[s];else{let u=e.length;e.push(h.getU()),t.push(h.getV()),i.push(h.getH()),o&&(n.push(h.getNormalX()),n.push(h.getNormalY())),h.newIndex=u,r[s]=u}}}3===p?(s.push(H[0].newIndex),s.push(H[1].newIndex),s.push(H[2].newIndex)):4===p&&(s.push(H[0].newIndex),s.push(H[1].newIndex),s.push(H[2].newIndex),s.push(H[0].newIndex),s.push(H[2].newIndex),s.push(H[3].newIndex))}H.push(new O),H.push(new O),H.push(new O),H.push(new O);var K=i(function(i,s){let p,l,a=i.isEastChild,c=i.isNorthChild,g=16383*!!a,S=a?32767:16383,T=16383*!!c,E=c?32767:16383;A.length=0,v.length=0,b.length=0,k.length=0,N.length=0;let q={},F=i.vertices,H=i.indices;H=H.subarray(0,i.indexCountWithoutSkirts);let K=t.clone(i.encoding),W=K.hasVertexNormals,P=0,Y=i.vertexCountWithoutSkirts,J=i.minimumHeight,L=i.maximumHeight,X=Array(Y),D=Array(Y),M=Array(Y),Z=W?Array(2*Y):void 0,G,Q,_,$,ee;for(Q=0,_=0;Q<Y;++Q,_+=2){let e=K.decodeTextureCoordinates(F,Q,R);if(G=K.decodeHeight(F,Q),$=d.clamp(32767*e.x|0,0,32767),ee=d.clamp(32767*e.y|0,0,32767),M[Q]=d.clamp((G-J)/(L-J)*32767|0,0,32767),$<20&&($=0),ee<20&&(ee=0),32767-$<20&&($=32767),32767-ee<20&&(ee=32767),X[Q]=$,D[Q]=ee,W){let e=K.getOctEncodedNormal(F,Q,z);Z[_]=e.x,Z[_+1]=e.y}(a&&$>=16383||!a&&$<=16383)&&(c&&ee>=16383||!c&&ee<=16383)&&(q[Q]=P,A.push($),v.push(ee),b.push(M[Q]),W&&(k.push(Z[_]),k.push(Z[_+1])),++P)}let et=[];et.push(new O),et.push(new O),et.push(new O);let ei=[];for(ei.push(new O),ei.push(new O),ei.push(new O),Q=0;Q<H.length;Q+=3){let e=H[Q],t=H[Q+1],i=H[Q+2],n=X[e],s=X[t],r=X[i];et[0].initializeIndexed(X,D,M,Z,e),et[1].initializeIndexed(X,D,M,Z,t),et[2].initializeIndexed(X,D,M,Z,i);let h=m.clipTriangleAtAxisAlignedThreshold(16383,a,n,s,r,w);(p=0)>=h.length||(p=ei[0].initializeFromClipResult(h,p,et))>=h.length||(p=ei[1].initializeFromClipResult(h,p,et))>=h.length||(p=ei[2].initializeFromClipResult(h,p,et),U(A,v,b,k,N,q,m.clipTriangleAtAxisAlignedThreshold(16383,c,ei[0].getV(),ei[1].getV(),ei[2].getV(),x),ei,W),p<h.length&&(ei[2].clone(ei[1]),ei[2].initializeFromClipResult(h,p,et),U(A,v,b,k,N,q,m.clipTriangleAtAxisAlignedThreshold(16383,c,ei[0].getV(),ei[1].getV(),ei[2].getV(),x),ei,W)))}let en=a?-32767:0,es=c?-32767:0,er=[],eh=[],eu=[],eo=[],ep=Number.MAX_VALUE,el=-ep;y.length=0;let ef=f.clone(i.ellipsoid),ed=u.clone(i.childRectangle),ea=ed.north,ec=ed.south,eg=ed.east,em=ed.west;for(eg<em&&(eg+=d.TWO_PI),Q=0;Q<A.length;++Q)($=Math.round(A[Q]))<=g?(er.push(Q),$=0):$>=S?(eu.push(Q),$=32767):$=2*$+en,A[Q]=$,(ee=Math.round(v[Q]))<=T?(eh.push(Q),ee=0):ee>=E?(eo.push(Q),ee=32767):ee=2*ee+es,v[Q]=ee,(G=d.lerp(J,L,b[Q]/32767))<ep&&(ep=G),G>el&&(el=G),b[Q]=G,B.longitude=d.lerp(em,eg,$/32767),B.latitude=d.lerp(ec,ea,ee/32767),B.height=G,ef.cartographicToCartesian(B,I),y.push(I.x),y.push(I.y),y.push(I.z);let ew=h.fromVertices(y,o.ZERO,3,j),ex=n.fromRectangle(ed,ep,el,ef,C),ey=new e(ef).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ew.center,y,3,ew.center,ep,V),eB=el-ep,eI=new Uint16Array(A.length+v.length+b.length);for(Q=0;Q<A.length;++Q)eI[Q]=A[Q];let eA=A.length;for(Q=0;Q<v.length;++Q)eI[eA+Q]=v[Q];for(eA+=v.length,Q=0;Q<b.length;++Q)eI[eA+Q]=32767*(b[Q]-ep)/eB;let ev=r.createTypedArray(A.length,N),eb;if(W){let e=new Uint8Array(k);s.push(eI.buffer,ev.buffer,e.buffer),eb=e.buffer}else s.push(eI.buffer,ev.buffer);return{vertices:eI.buffer,encodedNormals:eb,indices:ev.buffer,minimumHeight:ep,maximumHeight:el,westIndices:er,southIndices:eh,eastIndices:eu,northIndices:eo,boundingSphere:ew,orientedBoundingBox:ex,horizonOcclusionPoint:ey}});export{K as default};