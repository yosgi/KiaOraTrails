import{a as e}from"./chunk-JCUVYVZU.js";import{a as t}from"./chunk-JS6PT4NQ.js";import{a as n}from"./chunk-PWAJ3RAI.js";import{a as r}from"./chunk-R3AL5FUL.js";import{a as o,b as a,d as i,e as l}from"./chunk-JMSSU44E.js";import{a as s}from"./chunk-4UYSGV57.js";import{a as u}from"./chunk-VLPNAR64.js";import{b as f}from"./chunk-GE5NEIZC.js";import{d as c,e as h}from"./chunk-35CVRQTC.js";var y,p=c(e(),1),b=function(e){return f.defined("value",e),e<=.04045?.07739938080495357*e:Math.pow((e+.055)*.9478672985781991,2.4)};function g(e,t,n){for(let l=0;l<n.length;l++){let s=n[l].nativeExtent,u=new o;if("WebMercator"===n[l].projectionType){let o=n[l].projection._ellipsoid._radii;u=new r(new i(o.x,o.y,o.z)).project(new a(e,t,0))}else u.x=e,u.y=t;if(u.x>s.west&&u.x<s.east&&u.y>s.south&&u.y<s.north)return function(e,t,n){var r,o,a,i,l,s,u,f,c,h;let y=n.nativeExtent,p=(e-y.west)/(y.east-y.west)*(n.width-1),b=(t-y.south)/(y.north-y.south)*(n.height-1),g=Math.floor(p),d=Math.floor(b);p-=g,b-=d;let m=g<n.width?g+1:g,A=d<n.height?d+1:d;d=n.height-1-d,A=n.height-1-A;let w=(r=d,o=n.width,n.buffer[g+r*o]),x=(a=d,i=n.width,n.buffer[m+a*i]),I=(l=A,s=n.width,n.buffer[g+l*s]),v=(u=A,f=n.width,n.buffer[m+u*f]);return((w*(1-(c=p))+x*c)*(1-(h=b))+(I*(1-c)+v*c)*h)*n.scale+n.offset}(u.x,u.y,n[l])}return 0}var d=new o,m=new o,A=new o;function w(e,t,n,r){let a=3*n[t],i=3*n[t+1],l=3*n[t+2];o.fromArray(r,a,d),o.fromArray(r,i,m),o.fromArray(r,l,A),o.subtract(m,d,m),o.subtract(A,d,A),o.cross(m,A,d);let s=o.magnitude(d);0!==s&&o.divideByScalar(d,s,d),o.pack(d,e,3*t),o.pack(d,e,(t+1)*3),o.pack(d,e,(t+2)*3)}var x=new o,I=new o,v={position:function(e,t,n){let r=3*e.vertexCount;return e.positions=new Float32Array(t,n,r),n+=4*r},normal:function(e,t,n){let r=3*e.vertexCount;return e.normals=new Float32Array(t,n,r),n+=4*r},uv0:function(e,t,n){let r=2*e.vertexCount;return e.uv0s=new Float32Array(t,n,r),n+=4*r},color:function(e,t,n){let r=4*e.vertexCount;return e.colors=new Uint8Array(t,n,r),n+=r},featureId:function(e,t,n){return n+8*e.featureCount},id:function(e,t,n){return n+8*e.featureCount},faceRange:function(e,t,n){let r=2*e.featureCount;return e.faceRange=new Uint32Array(t,n,r),n+=4*r},uvRegion:function(e,t,n){let r=4*e.vertexCount;return e["uv-region"]=new Uint16Array(t,n,r),n+=2*r},region:function(e,t,n){let r=4*e.vertexCount;return e["uv-region"]=new Uint16Array(t,n,r),n+=2*r}};async function L(e,t){let n=e.webAssemblyConfig;return y=h(n)&&h(n.wasmBinaryFile)?await (0,p.default)(n):await (0,p.default)(),!0}var C=n(function(e,n){return h(e.webAssemblyConfig)?L(e,n):function(e){var n,r,f,c;let p;let d,m=(n=e.binaryData,r=e.schema,f=e.bufferInfo,c=e.featureData,68===(p=new Uint8Array(n,0,5))[0]&&82===p[1]&&65===p[2]&&67===p[3]&&79===p[4]?function(e){let t=y,n=new t.DecoderBuffer,r=new Uint8Array(e);n.Init(r,r.length);let o=new t.Decoder,a=o.GetEncodedGeometryType(n),i=new t.MetadataQuerier,l,s;a===t.TRIANGULAR_MESH&&(l=new t.Mesh,s=o.DecodeBufferToMesh(n,l));let u={vertexCount:[0],featureCount:0};if(h(s)&&s.ok()&&0!==l.ptr){let e=l.num_faces(),n=l.num_attributes(),r=l.num_points();u.indices=new Uint32Array(3*e);let a=u.indices;u.vertexCount[0]=r,u.scale_x=1,u.scale_y=1;let s=new t.DracoInt32Array(3);for(let t=0;t<e;++t)o.GetFaceFromMesh(l,t,s),a[3*t]=s.GetValue(0),a[3*t+1]=s.GetValue(1),a[3*t+2]=s.GetValue(2);t.destroy(s);for(let e=0;e<n;++e){let n=o.GetAttribute(l,e),a=function(e,t,n,r,o){let a=r.num_components()*o,i,l=[function(){},function(){i=new e.DracoInt8Array(a),t.GetAttributeInt8ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Int8Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt8Array(a),t.GetAttributeUInt8ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint8Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt16Array(a),t.GetAttributeInt16ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Int16Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt16Array(a),t.GetAttributeUInt16ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint16Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt32Array(a),t.GetAttributeInt32ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Int32Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){i=new e.DracoInt32Array(a),t.GetAttributeUInt32ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint32Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){},function(){},function(){i=new e.DracoFloat32Array(a),t.GetAttributeFloatForAllPoints(n,r,i)||console.error("Bad stream");let o=new Float32Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o},function(){},function(){i=new e.DracoUInt8Array(a),t.GetAttributeUInt8ForAllPoints(n,r,i)||console.error("Bad stream");let o=new Uint8Array(a);for(let e=0;e<a;++e)o[e]=i.GetValue(e);return o}][r.data_type()]();return h(i)&&e.destroy(i),l}(t,o,l,n,r),s=n.attribute_type(),f="unknown";s===t.POSITION?f="positions":s===t.NORMAL?f="normals":s===t.COLOR?f="colors":s===t.TEX_COORD&&(f="uv0s");let c=o.GetAttributeMetadata(l,e);if(0!==c.ptr){let e=i.NumEntries(c);for(let t=0;t<e;++t){let e=i.GetEntryName(c,t);"i3s-scale_x"===e?u.scale_x=i.GetDoubleEntry(c,"i3s-scale_x"):"i3s-scale_y"===e?u.scale_y=i.GetDoubleEntry(c,"i3s-scale_y"):"i3s-attribute-type"===e&&(f=i.GetStringEntry(c,"i3s-attribute-type"))}}h(u[f])&&console.log("Attribute already exists",f),u[f]=a,"feature-index"===f&&u.featureCount++}t.destroy(l)}return t.destroy(i),t.destroy(o),u}(n,f):function(e,t,n,r){let o={vertexCount:0},a=new DataView(e);try{let i=0;if(o.vertexCount=a.getUint32(i,1),i+=4,o.featureCount=a.getUint32(i,1),i+=4,h(n))for(let t=0;t<n.attributes.length;t++)h(v[n.attributes[t]])?i=v[n.attributes[t]](o,e,i):console.error("Unknown decoder for",n.attributes[t]);else{let n=t.ordering,a=t.featureAttributeOrder;h(r)&&h(r.geometryData)&&h(r.geometryData[0])&&h(r.geometryData[0].params)&&(n=Object.keys(r.geometryData[0].params.vertexAttributes),a=Object.keys(r.geometryData[0].params.featureAttributes));for(let t=0;t<n.length;t++)i=(0,v[n[t]])(o,e,i);for(let t=0;t<a.length;t++)i=(0,v[a[t]])(o,e,i)}}catch(e){console.error(e)}return o.scale_x=1,o.scale_y=1,o}(n,r,f,c));if(h(e.geoidDataList)&&e.geoidDataList.length>0&&function(e,t,n,r,o,a,i){if(i)return;let l=g(o.longitude,o.latitude,a);for(let i=0;i<e;++i){let e=g(o.longitude+s.toRadians(n*t[3*i]),o.latitude+s.toRadians(r*t[3*i+1]),a);t[3*i+2]+=e-l}}(m.vertexCount,m.positions,m.scale_x,m.scale_y,e.cartographicCenter,e.geoidDataList,!1),function(e,t,n,r,u,f,c,y,p){if(0===e||!h(t)||0===t.length)return;let b=new i(Math.sqrt(c.x),Math.sqrt(c.y),Math.sqrt(c.z));for(let i=0;i<e;++i){let e=3*i,c=e+1,g=e+2,d=new a;d.longitude=r.longitude+s.toRadians(y*t[e]),d.latitude=r.latitude+s.toRadians(p*t[c]),d.height=r.height+t[g];let m={};b.cartographicToCartesian(d,m),m.x-=u.x,m.y-=u.y,m.z-=u.z;let A={};if(l.multiplyByVector(f,m,A),t[e]=A.x,t[c]=A.y,t[g]=A.z,h(n)){let t=new o(n[e],n[c],n[g]),r={};l.multiplyByVector(f,t,r),n[e]=r.x,n[c]=r.y,n[g]=r.z}}}(m.vertexCount,m.positions,m.normals,e.cartographicCenter,e.cartesianCenter,e.parentRotation,e.ellipsoidRadiiSquare,m.scale_x,m.scale_y),h(m.uv0s)&&h(m["uv-region"])&&function(e,t,n){for(let r=0;r<e;++r){let e=n[4*r]/65535,o=n[4*r+1]/65535,a=(n[4*r+2]-n[4*r])/65535,i=(n[4*r+3]-n[4*r+1])/65535;t[2*r]*=a,t[2*r]+=e,t[2*r+1]*=i,t[2*r+1]+=o}}(m.vertexCount,m.uv0s,m["uv-region"]),h(m["feature-index"]))d=m["feature-index"];else if(h(m.faceRange)){d=Array(m.vertexCount);for(let e=0;e<m.faceRange.length-1;e+=2){let t=e/2,n=m.faceRange[e],r=m.faceRange[e+1];for(let e=n;e<=r;e++)d[3*e]=t,d[3*e+1]=t,d[3*e+2]=t}}if(e.calculateNormals){let e=function(e,t,n,r,o,a,i){let l={normals:void 0,positions:void 0,uv0s:void 0,colors:void 0,featureIndex:void 0,vertexCount:void 0};if(0===e||!h(n)||0===n.length||h(r))return l;if(h(t)){l.vertexCount=t.length,l.positions=new Float32Array(3*t.length),l.uv0s=h(o)?new Float32Array(2*t.length):void 0,l.colors=h(a)?new Uint8Array(4*t.length):void 0,l.featureIndex=h(i)?Array(t.length):void 0;for(let e=0;e<t.length;e++){let r=t[e];l.positions[3*e]=n[3*r],l.positions[3*e+1]=n[3*r+1],l.positions[3*e+2]=n[3*r+2],h(l.uv0s)&&(l.uv0s[2*e]=o[2*r],l.uv0s[2*e+1]=o[2*r+1]),h(l.colors)&&(l.colors[4*e]=a[4*r],l.colors[4*e+1]=a[4*r+1],l.colors[4*e+2]=a[4*r+2],l.colors[4*e+3]=a[4*r+3]),h(l.featureIndex)&&(l.featureIndex[e]=i[r])}e=t.length,n=l.positions}t=Array(e);for(let n=0;n<e;n++)t[n]=n;l.normals=new Float32Array(3*t.length);for(let e=0;e<t.length;e+=3)w(l.normals,e,t,n);return l}(m.vertexCount,m.indices,m.positions,m.normals,m.uv0s,m.colors,d);h(e.normals)&&(m.normals=e.normals,h(e.vertexCount)&&(m.vertexCount=e.vertexCount,m.indices=e.indices,m.positions=e.positions,m.uv0s=e.uv0s,m.colors=e.colors,d=e.featureIndex))}let A=function(e,n,r,a,i,l,s,f){if(0===e||!h(r)||0===r.length)return{buffers:[],bufferViews:[],accessors:[],meshes:[],nodes:[],nodesInScene:[]};let c=[],y=[],p=[],g=[],d=[],m=[],A={},v=[];h(n)&&(e=n.length);let{indexArray:L,transparentVertexOffset:C}=function(e,t,n,r){let o=new Uint32Array(e),a=h(t)?e=>t[e]:e=>e,i=0;if(r&&h(n)){let t=e=>n[4*a(e)+3]<255;for(let n=0;n<e;n+=3)t(n)||t(n+1)||t(n+2)||(o[i++]=a(n),o[i++]=a(n+1),o[i++]=a(n+2));if(i>0){let n=i;for(let r=0;r<e;r+=3)(t(r)||t(r+1)||t(r+2))&&(o[n++]=a(r),o[n++]=a(r+1),o[n++]=a(r+2))}else for(let t=0;t<e;++t)o[t]=a(t)}else{i=e;for(let t=0;t<e;++t)o[t]=a(t)}return{indexArray:o,transparentVertexOffset:i}}(e,n,l,f.splitGeometryByColorTransparency),O=new Blob([L],{type:"application/binary"}),R=URL.createObjectURL(O),U=e,T=f.enableFeatures&&h(s)?new Float32Array(s.length):void 0,_=0;if(h(T))for(let e=0;e<s.length;++e){T[e]=s[e];let t=s[e]+1;_<t&&(_=t)}let V,F=function(e,t,n,r,a){if(!h(e)||0===Object.keys(e).length)return;let i=function(e,t,n,r){let o=[];for(let a=0;a<n.length;a+=3){let i=function(e,t,n){let r=t[n];if(h(r))return r;let o=t[n]={positions:{},indices:{},edges:{}},a=u(e[n],e.default);return o.hasOutline=h(a?.edges),o}(e,o,h(t)?t[n[a]]:"default");if(!i.hasOutline)continue;let l=i.indices,s=i.positions;for(let e=0;e<3;e++)!function(e,t,n,r){if(!h(e[n])){let o=3*n,a=t;for(let e=0;e<3;e++){let t=r[o+e];h(a[t])||(a[t]={}),a=a[t]}h(a.index)||(a.index=n),e[n]=a.index}}(l,s,n[a+e],r);let f=i.edges;for(let e=0;e<3;e++){let t=n[a+e],r=n[a+(e+1)%3],o=l[t],i=l[r];!function(e,t,n,r,o,a){let i,l;r<o?(i=r,l=o):(i=o,l=r);let s=e[i];h(s)||(s=e[i]={});let u=s[l];h(u)||(u=s[l]={normalsIndex:[],outlines:[]}),u.normalsIndex.push(a),(0===u.outlines.length||t!==r||n!==o)&&u.outlines.push(t,n)}(f,t,r,o,i,a)}}return o}(e,t,n,r);h(a)&&3*n.length===a.length||(a=[]);let l=function(e,t,n,r){let a=[],i=Object.keys(e);for(let l=0;l<i.length;l++)!function(e,t,n,r,a){let i=Object.keys(t);for(let l=0;l<i.length;l++){let s=t[i[l]],u=Object.keys(s);for(let t=0;t<u.length;t++)!function(e,t,n,r,a){if(t.normalsIndex.length>1){let e=r.length===a.length;for(let i=0;i<t.normalsIndex.length;i++){let l=t.normalsIndex[i];if(h(a[3*l])||w(a,l,n,r),0!==i)for(let r=0;r<i;r++){let i=t.normalsIndex[r];if(function(e,t,n){o.fromArray(e,t,x),o.fromArray(e,n,I);let r=o.dot(x,I);return .25>Math.atan2(o.magnitude(o.cross(x,I,x)),r)}(a,e?3*n[l]:3*l,e?3*n[i]:3*i))return}}}e.push(...t.outlines)}(e,s[u[t]],n,r,a)}}(a,e[i[l]].edges,t,n,r);return a}(i,n,r,a);return l.length>0?new Uint32Array(l):void 0}(f.symbologyData,s,L,r,a);if(h(F)){let e=new Blob([F],{type:"application/binary"});V=URL.createObjectURL(e)}let E=r.subarray(0,3*U),G=new Blob([E],{type:"application/binary"}),N=URL.createObjectURL(G),D=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,M=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,B=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let e=0;e<E.length/3;e++)D=Math.min(D,E[3*e+0]),j=Math.max(j,E[3*e+0]),M=Math.min(M,E[3*e+1]),S=Math.max(S,E[3*e+1]),B=Math.min(B,E[3*e+2]),k=Math.max(k,E[3*e+2]);let P=a?a.subarray(0,3*U):void 0,Y;if(h(P)){let e=new Blob([P],{type:"application/binary"});Y=URL.createObjectURL(e)}let z=i?i.subarray(0,2*U):void 0,X;if(h(z)){let e=new Blob([z],{type:"application/binary"});X=URL.createObjectURL(e)}let q=h(l)?function(e){let n=new Float32Array(e.length);for(let r=0;r<e.length;r+=4)n[r]=b(t.byteToFloat(e[r])),n[r+1]=b(t.byteToFloat(e[r+1])),n[r+2]=b(t.byteToFloat(e[r+2])),n[r+3]=t.byteToFloat(e[r+3]);return n}(l.subarray(0,4*U)):void 0,J;if(h(q)){let e=new Blob([q],{type:"application/binary"});J=URL.createObjectURL(e)}let Q=h(T)?T.subarray(0,U):void 0,W;if(h(Q)){let e=new Blob([Q],{type:"application/binary"});W=URL.createObjectURL(e)}let Z=h(T)?new Float32Array(_):void 0,H;if(h(Z)){for(let e=0;e<Z.length;++e)Z[e]=e;let e=new Blob([Z],{type:"application/binary"});H=URL.createObjectURL(e)}let K={},$={};K.POSITION=p.length,c.push({uri:N,byteLength:E.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:E.byteLength,target:34962}),p.push({bufferView:y.length-1,byteOffset:0,componentType:5126,count:E.length/3,type:"VEC3",max:[D,M,B],min:[j,S,k]}),h(Y)&&(K.NORMAL=p.length,c.push({uri:Y,byteLength:P.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:P.byteLength,target:34962}),p.push({bufferView:y.length-1,byteOffset:0,componentType:5126,count:P.length/3,type:"VEC3"})),h(X)&&(K.TEXCOORD_0=p.length,c.push({uri:X,byteLength:z.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:z.byteLength,target:34962}),p.push({bufferView:y.length-1,byteOffset:0,componentType:5126,count:z.length/2,type:"VEC2"})),h(J)&&(K.COLOR_0=p.length,c.push({uri:J,byteLength:q.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:q.byteLength,target:34962}),p.push({bufferView:y.length-1,byteOffset:0,componentType:5126,count:q.length/4,type:"VEC4"})),h(W)&&(K._FEATURE_ID_0=p.length,c.push({uri:W,byteLength:Q.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:Q.byteLength,target:34963}),p.push({bufferView:y.length-1,byteOffset:0,componentType:5126,count:Q.length,type:"SCALAR"}),$.EXT_mesh_features={featureIds:[{attribute:0,propertyTable:0,featureCount:_}]},v.push("EXT_mesh_features")),h(H)&&(c.push({uri:H,byteLength:Z.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:Z.byteLength,target:34963}),A.EXT_structural_metadata={schema:{id:"i3s-metadata-schema-001",name:"I3S metadata schema 001",description:"The schema for I3S metadata",version:"1.0",classes:{feature:{name:"feature",description:"Feature metadata",properties:{index:{description:"The feature index",type:"SCALAR",componentType:"FLOAT32",required:!0}}}}},propertyTables:[{name:"feature-indices-mapping",class:"feature",count:_,properties:{index:{values:y.length-1}}}]},v.push("EXT_structural_metadata")),h(V)&&(c.push({uri:V,byteLength:F.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:F.byteLength,target:34963}),p.push({bufferView:y.length-1,byteOffset:0,componentType:5125,count:F.length,type:"SCALAR"}),$.CESIUM_primitive_outline={indices:p.length-1},v.push("CESIUM_primitive_outline")),c.push({uri:R,byteLength:L.byteLength}),y.push({buffer:c.length-1,byteOffset:0,byteLength:L.byteLength,target:34963});let ee=[];return C>0&&(p.push({bufferView:y.length-1,byteOffset:0,componentType:5125,count:C,type:"SCALAR"}),ee.push({attributes:K,indices:p.length-1,material:ee.length,extensions:$})),C<e&&(p.push({bufferView:y.length-1,byteOffset:4*C,componentType:5125,count:e-C,type:"SCALAR"}),ee.push({attributes:K,indices:p.length-1,material:ee.length,extensions:$,extra:{isTransparent:!0}})),g.push({primitives:ee}),m.push(0),d.push({mesh:0}),{buffers:c,bufferViews:y,accessors:p,meshes:g,nodes:d,nodesInScene:m,rootExtensions:A,extensionsUsed:v}}(m.vertexCount,m.indices,m.positions,m.normals,m.uv0s,m.colors,d,e);return A._customAttributes={positions:m.positions,indices:m.indices,featureIndex:d,sourceURL:e.url,cartesianCenter:e.cartesianCenter,parentRotation:e.parentRotation},{meshData:A}}(e,n)});export{C as default};