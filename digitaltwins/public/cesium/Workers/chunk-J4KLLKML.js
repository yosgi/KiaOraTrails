import{a as e}from"./chunk-R3AL5FUL.js";import{a as t}from"./chunk-AOALMXNW.js";import{a as r}from"./chunk-NNHN6WUY.js";import{a as n}from"./chunk-T7ERZ2CJ.js";import{c as o,d as i}from"./chunk-GSNDLQ4C.js";import{a as s,d as a}from"./chunk-BKSIEBAA.js";import{b as c}from"./chunk-YWRPWWKI.js";import{a as l}from"./chunk-VTVHUB7E.js";import{d as u}from"./chunk-JMSSU44E.js";import{a as p}from"./chunk-VLPNAR64.js";import{a as f,b as m}from"./chunk-GE5NEIZC.js";import{e as h}from"./chunk-35CVRQTC.js";function d(e,t,r){e=p(e,0),t=p(t,0),r=p(r,0),this.value=new Float32Array([e,t,r])}function g(e,t){let r=e.attributes,n=r.position,o=n.values.length/n.componentsPerAttribute;r.batchId=new i({componentDatatype:l.FLOAT,componentsPerAttribute:1,values:new Float32Array(o)});let s=r.batchId.values;for(let e=0;e<o;++e)s[e]=t}function y(e,t,r,n){let o,i,s,a=n.length-1;if(a>=0){let e=n[a];o=e.offset+e.count,i=r[s=e.index].indices.length}else o=0,i=r[s=0].indices.length;let c=e.length;for(let a=0;a<c;++a){let c=e[a][t];if(!h(c))continue;let l=c.indices.length;o+l>i&&(o=0,i=r[++s].indices.length),n.push({index:s,offset:o,count:l}),o+=l}}Object.defineProperties(d.prototype,{componentDatatype:{get:function(){return l.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),d.fromCartesian3=function(e){return m.defined("offset",e),new d(e.x,e.y,e.z)},d.toValue=function(e,t){return m.defined("offset",e),h(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t};var b={};function k(e){let t=e.length,r=new Float32Array(1+(a.packedLength+1)*t),n=0;r[n++]=t;for(let o=0;o<t;++o)h(e[o])?(r[n++]=1,a.pack(e[o],r,n)):r[n++]=0,n+=a.packedLength;return r}function x(e){let t=Array(e[0]),r=0,n=1;for(;n<e.length;)1===e[n++]&&(t[r]=a.unpack(e,n)),++r,n+=a.packedLength;return t}b.combineGeometry=function(e){var r;let n,o,i,s=e.instances,u=s.length,p,m,d=!1;u>0&&((o=function(e){let r=e.instances,n=e.projection,o=e.elementIndexUintSupported,i=e.scene3DOnly,s=e.vertexCacheOptimize,u=e.compressVertices,p=e.modelMatrix,m,d,y,b=r.length;for(m=0;m<b;++m)if(h(r[m].geometry)){y=r[m].geometry.primitiveType;break}for(m=1;m<b;++m)if(h(r[m].geometry)&&r[m].geometry.primitiveType!==y)throw new f("All instance geometries must have the same primitiveType.");if(function(e,r,n){let o=!n,i=e.length,s;if(!o&&i>1){let t=e[0].modelMatrix;for(s=1;s<i;++s)if(!c.equals(t,e[s].modelMatrix)){o=!0;break}}if(o)for(s=0;s<i;++s)h(e[s].geometry)&&t.transformToWorldCoordinates(e[s]);else c.multiplyTransformation(r,e[0].modelMatrix,r)}(r,p,i),!i)for(m=0;m<b;++m)h(r[m].geometry)&&t.splitLongitude(r[m]);if(function(e){let t=e.length;for(let r=0;r<t;++r){let t=e[r];h(t.geometry)?g(t.geometry,r):h(t.westHemisphereGeometry)&&h(t.eastHemisphereGeometry)&&(g(t.westHemisphereGeometry,r),g(t.eastHemisphereGeometry,r))}}(r),s)for(m=0;m<b;++m){let e=r[m];h(e.geometry)?(t.reorderForPostVertexCache(e.geometry),t.reorderForPreVertexCache(e.geometry)):h(e.westHemisphereGeometry)&&h(e.eastHemisphereGeometry)&&(t.reorderForPostVertexCache(e.westHemisphereGeometry),t.reorderForPreVertexCache(e.westHemisphereGeometry),t.reorderForPostVertexCache(e.eastHemisphereGeometry),t.reorderForPreVertexCache(e.eastHemisphereGeometry))}let k=t.combineInstances(r);for(b=k.length,m=0;m<b;++m){let e=(d=k[m]).attributes;if(i)for(let r in e)e.hasOwnProperty(r)&&e[r].componentDatatype===l.DOUBLE&&t.encodeAttribute(d,r,`${r}3DHigh`,`${r}3DLow`);else for(let r in e)if(e.hasOwnProperty(r)&&e[r].componentDatatype===l.DOUBLE){let e=`${r}3D`,o=`${r}2D`;t.projectTo2D(d,r,e,o,n),h(d.boundingSphere)&&"position"===r&&(d.boundingSphereCV=a.fromVertices(d.attributes.position2D.values)),t.encodeAttribute(d,e,`${e}High`,`${e}Low`),t.encodeAttribute(d,o,`${o}High`,`${o}Low`)}u&&t.compressVertices(d)}if(!o){let e=[];for(b=k.length,m=0;m<b;++m)d=k[m],e=e.concat(t.fitToUnsignedShortIndices(d));k=e}return k}(e)).length>0&&(i=t.createAttributeLocations(o[0]),e.createPickOffsets&&(n=[],y(s,"geometry",r=o,n),y(s,"westHemisphereGeometry",r,n),y(s,"eastHemisphereGeometry",r,n),p=n)),h(s[0].attributes)&&h(s[0].attributes.offset)&&(m=Array(u),d=!0));let b=Array(u),k=Array(u);for(let e=0;e<u;++e){let t=s[e],r=t.geometry;h(r)&&(b[e]=r.boundingSphere,k[e]=r.boundingSphereCV,d&&(m[e]=t.geometry.offsetAttribute));let n=t.eastHemisphereGeometry,o=t.westHemisphereGeometry;h(n)&&h(o)&&(h(n.boundingSphere)&&h(o.boundingSphere)&&(b[e]=a.union(n.boundingSphere,o.boundingSphere)),h(n.boundingSphereCV)&&h(o.boundingSphereCV)&&(k[e]=a.union(n.boundingSphereCV,o.boundingSphereCV)))}return{geometries:o,modelMatrix:e.modelMatrix,attributeLocations:i,pickOffsets:p,offsetInstanceExtend:m,boundingSpheres:b,boundingSpheresCV:k}},b.packCreateGeometryResults=function(e,t){let r=new Float64Array(function(e){let t=1,r=e.length;for(let n=0;n<r;n++){let r=e[n];if(++t,!h(r))continue;let o=r.attributes;for(let e in t+=7+2*a.packedLength+(h(r.indices)?r.indices.length:0),o)o.hasOwnProperty(e)&&h(o[e])&&(t+=5+o[e].values.length)}return t}(e)),n=[],o={},i=e.length,s=0;r[s++]=i;for(let t=0;t<i;t++){let i=e[t],c=h(i);if(r[s++]=+!!c,!c)continue;r[s++]=i.primitiveType,r[s++]=i.geometryType,r[s++]=p(i.offsetAttribute,-1);let l=+!!h(i.boundingSphere);r[s++]=l,l&&a.pack(i.boundingSphere,r,s),s+=a.packedLength;let u=+!!h(i.boundingSphereCV);r[s++]=u,u&&a.pack(i.boundingSphereCV,r,s),s+=a.packedLength;let f=i.attributes,m=[];for(let e in f)f.hasOwnProperty(e)&&h(f[e])&&(m.push(e),h(o[e])||(o[e]=n.length,n.push(e)));r[s++]=m.length;for(let e=0;e<m.length;e++){let t=m[e],n=f[t];r[s++]=o[t],r[s++]=n.componentDatatype,r[s++]=n.componentsPerAttribute,r[s++]=+!!n.normalize,r[s++]=n.values.length,r.set(n.values,s),s+=n.values.length}let d=h(i.indices)?i.indices.length:0;r[s++]=d,d>0&&(r.set(i.indices,s),s+=d)}return t.push(r.buffer),{stringTable:n,packedData:r}},b.unpackCreateGeometryResults=function(e){let t=e.stringTable,s=e.packedData,c,u=Array(s[0]),p=0,f=1;for(;f<s.length;){let e,m,h;if(1!==s[f++]){u[p++]=void 0;continue}let d=s[f++],g=s[f++],y=s[f++];-1===y&&(y=void 0),1===s[f++]&&(e=a.unpack(s,f)),f+=a.packedLength,1===s[f++]&&(m=a.unpack(s,f)),f+=a.packedLength;let b,k,x,C=new n,S=s[f++];for(c=0;c<S;c++){let e=t[s[f++]],r=s[f++];x=s[f++];let n=0!==s[f++];b=s[f++],k=l.createTypedArray(r,b);for(let e=0;e<b;e++)k[e]=s[f++];C[e]=new i({componentDatatype:r,componentsPerAttribute:x,normalize:n,values:k})}if((b=s[f++])>0){let e=k.length/x;for(h=r.createTypedArray(e,b),c=0;c<b;c++)h[c]=s[f++]}u[p++]=new o({primitiveType:d,geometryType:g,boundingSphere:e,boundingSphereCV:m,indices:h,attributes:C,offsetAttribute:y})}return u},b.packCombineGeometryParameters=function(e,t){let r=e.createGeometryResults,n=r.length;for(let e=0;e<n;e++)t.push(r[e].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:function(e,t){let r=e.length,n=new Float64Array(1+19*r),o=0;n[o++]=r;for(let t=0;t<r;t++){let r=e[t];if(c.pack(r.modelMatrix,n,o),o+=c.packedLength,h(r.attributes)&&h(r.attributes.offset)){let e=r.attributes.offset.value;n[o]=e[0],n[o+1]=e[1],n[o+2]=e[2]}o+=3}return t.push(n.buffer),n}(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof s,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},b.unpackCombineGeometryParameters=function(t){let r=function(e){let t=Array(e[0]),r=0,n=1;for(;n<e.length;){let o=c.unpack(e,n),i;h(e[n+=c.packedLength])&&(i={offset:new d(e[n],e[n+1],e[n+2])}),n+=3,t[r++]={modelMatrix:o,attributes:i}}return t}(t.packedInstances),n=t.createGeometryResults,o=n.length,i=0;for(let e=0;e<o;e++){let t=b.unpackCreateGeometryResults(n[e]),o=t.length;for(let e=0;e<o;e++){let n=t[e];r[i].geometry=n,++i}}let a=u.clone(t.ellipsoid),l=t.isGeographic?new s(a):new e(a);return{instances:r,ellipsoid:a,projection:l,elementIndexUintSupported:t.elementIndexUintSupported,scene3DOnly:t.scene3DOnly,vertexCacheOptimize:t.vertexCacheOptimize,compressVertices:t.compressVertices,modelMatrix:c.clone(t.modelMatrix),createPickOffsets:t.createPickOffsets}},b.packCombineGeometryResults=function(e,t){h(e.geometries)&&function(e,t){let r=e.length;for(let n=0;n<r;++n)!function(e,t){let r=e.attributes;for(let e in r)if(r.hasOwnProperty(e)){let n=r[e];h(n)&&h(n.values)&&t.push(n.values.buffer)}h(e.indices)&&t.push(e.indices.buffer)}(e[n],t)}(e.geometries,t);let r=k(e.boundingSpheres),n=k(e.boundingSpheresCV);return t.push(r.buffer,n.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:r,boundingSpheresCV:n}},b.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:x(e.boundingSpheres),boundingSpheresCV:x(e.boundingSpheresCV)}};var C=b;export{C as a};