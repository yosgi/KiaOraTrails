import{a as e}from"./chunk-JS6PT4NQ.js";import{a as t}from"./chunk-PWAJ3RAI.js";import{a as n}from"./chunk-O3CFQFRB.js";import{a as r}from"./chunk-CXNPIJLB.js";import"./chunk-FNJKWSPR.js";import"./chunk-KSZ5EBRB.js";import"./chunk-V3DSE3OK.js";import"./chunk-FMRIJYNG.js";import{a as a}from"./chunk-NNHN6WUY.js";import"./chunk-BKSIEBAA.js";import{h as o}from"./chunk-YWRPWWKI.js";import"./chunk-VTVHUB7E.js";import{a as i,b as s,d as f}from"./chunk-JMSSU44E.js";import{a as h}from"./chunk-4UYSGV57.js";import"./chunk-ANLJ4KBN.js";import"./chunk-ID6SFQTL.js";import"./chunk-VLPNAR64.js";import"./chunk-GE5NEIZC.js";import{e as c}from"./chunk-35CVRQTC.js";var l=new i,u=new f,m=new o,p={min:void 0,max:void 0,indexBytesPerElement:void 0},d=new i,g=new i,I=new i,k=new i,b=new i,y=new s,N=new o,w=t(function(t,w){let A,x,E;x=new Float64Array(t.packedBuffer),E=0,p.indexBytesPerElement=x[E++],p.min=x[E++],p.max=x[E++],i.unpack(x,E,l),E+=i.packedLength,f.unpack(x,E,u),E+=f.packedLength,o.unpack(x,E,m),A=2===p.indexBytesPerElement?new Uint16Array(t.indices):new Uint32Array(t.indices);let T=new Uint16Array(t.positions),L=new Uint32Array(t.counts),j=new Uint32Array(t.indexCounts),S=new Uint32Array(t.batchIds),B=new Uint32Array(t.batchTableColors),U=Array(L.length),F=m,P=p.min,O=p.max,R=t.minimumHeights,C=t.maximumHeights;c(R)&&c(C)&&(R=new Float32Array(R),C=new Float32Array(C));let V,Y,G,J=T.length/2,_=T.subarray(0,J),M=T.subarray(J,2*J);r.zigZagDeltaDecode(_,M);let D=new Float64Array(3*J);for(V=0;V<J;++V){let e=_[V],t=M[V],n=h.lerp(F.west,F.east,e/32767),r=h.lerp(F.south,F.north,t/32767),a=s.fromRadians(n,r,0,y),o=u.cartographicToCartesian(a,d);i.pack(o,D,3*V)}let K=L.length,W=Array(K),H=Array(K),v=0,Q=0;for(V=0;V<K;++V)W[V]=v,H[V]=Q,v+=L[V],Q+=j[V];let Z=new Float32Array(6*J),z=new Uint16Array(2*J),X=new Uint32Array(H.length),q=new Uint32Array(j.length),$=[],ee={};for(V=0;V<K;++V)c(ee[G=B[V]])?(ee[G].positionLength+=L[V],ee[G].indexLength+=j[V],ee[G].batchIds.push(V)):ee[G]={positionLength:L[V],indexLength:j[V],offset:0,indexOffset:0,batchIds:[V]};let et,en=0,er=0;for(G in ee)if(ee.hasOwnProperty(G)){(et=ee[G]).offset=en,et.indexOffset=er;let e=2*et.positionLength,t=2*et.indexLength+6*et.positionLength;en+=e,er+=t,et.indexLength=t}let ea=[];for(G in ee)ee.hasOwnProperty(G)&&(et=ee[G],ea.push({color:e.fromRgba(parseInt(G)),offset:et.indexOffset,count:et.indexLength,batchIds:et.batchIds}));for(V=0;V<K;++V){let e=(et=ee[G=B[V]]).offset,t=3*e,r=e,a=W[V],o=L[V],s=S[V],f=P,h=O;c(R)&&c(C)&&(f=R[V],h=C[V]);let m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,w=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(Y=0;Y<o;++Y){let e=i.unpack(D,3*a+3*Y,d);u.scaleToGeodeticSurface(e,e);let n=u.cartesianToCartographic(e,y),o=n.latitude,c=n.longitude;m=Math.min(o,m),p=Math.max(o,p),w=Math.min(c,w),x=Math.max(c,x);let N=u.geodeticSurfaceNormal(e,g),A=i.multiplyByScalar(N,f,I),E=i.add(e,A,k);A=i.multiplyByScalar(N,h,A);let T=i.add(e,A,b);i.subtract(T,l,T),i.subtract(E,l,E),i.pack(T,Z,t),i.pack(E,Z,t+3),z[r]=s,z[r+1]=s,t+=6,r+=2}(F=N).west=w,F.east=x,F.south=m,F.north=p,U[V]=n.fromRectangle(F,P,O,u);let E=et.indexOffset,T=H[V],J=j[V];for(X[V]=E,Y=0;Y<J;Y+=3){let t=A[T+Y]-a,n=A[T+Y+1]-a,r=A[T+Y+2]-a;$[E++]=2*t+e,$[E++]=2*n+e,$[E++]=2*r+e,$[E++]=2*r+1+e,$[E++]=2*n+1+e,$[E++]=2*t+1+e}for(Y=0;Y<o;++Y){let t=Y,n=(Y+1)%o;$[E++]=2*t+1+e,$[E++]=2*n+e,$[E++]=2*t+e,$[E++]=2*t+1+e,$[E++]=2*n+1+e,$[E++]=2*n+e}et.offset+=2*o,et.indexOffset=E,q[V]=E-X[V]}$=a.createTypedArray(Z.length/3,$);let eo=ea.length;for(let e=0;e<eo;++e){let t=ea[e].batchIds,n=0,r=t.length;for(let e=0;e<r;++e)n+=q[t[e]];ea[e].count=n}let ei=function(t,r,a){let o=r.length,i=new Float64Array(2+o*n.packedLength+1+function(t){let n=t.length,r=0;for(let a=0;a<n;++a)r+=e.packedLength+3+t[a].batchIds.length;return r}(a)),s=0;i[s++]=t,i[s++]=o;for(let e=0;e<o;++e)n.pack(r[e],i,s),s+=n.packedLength;let f=a.length;i[s++]=f;for(let t=0;t<f;++t){let n=a[t];e.pack(n.color,i,s),s+=e.packedLength,i[s++]=n.offset,i[s++]=n.count;let r=n.batchIds,o=r.length;i[s++]=o;for(let e=0;e<o;++e)i[s++]=r[e]}return i}(2===$.BYTES_PER_ELEMENT?a.UNSIGNED_SHORT:a.UNSIGNED_INT,U,ea);return w.push(Z.buffer,$.buffer,X.buffer,q.buffer,z.buffer,ei.buffer),{positions:Z.buffer,indices:$.buffer,indexOffsets:X.buffer,indexCounts:q.buffer,batchIds:z.buffer,packedBuffer:ei.buffer}});export{w as default};