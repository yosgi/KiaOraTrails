import{a as e}from"./chunk-JS6PT4NQ.js";import{a as t}from"./chunk-3A7LMSMN.js";import"./chunk-ICZXFP3D.js";import{a as n}from"./chunk-4YP32ZNP.js";import{a as r}from"./chunk-PWAJ3RAI.js";import{a as o}from"./chunk-42IXF5OF.js";import"./chunk-ZFTFDHK4.js";import"./chunk-74GQJJ7R.js";import{a as i}from"./chunk-NNHN6WUY.js";import"./chunk-T7ERZ2CJ.js";import"./chunk-GSNDLQ4C.js";import{d as s}from"./chunk-BKSIEBAA.js";import{b as a}from"./chunk-YWRPWWKI.js";import"./chunk-VTVHUB7E.js";import{a as c}from"./chunk-JMSSU44E.js";import"./chunk-4UYSGV57.js";import"./chunk-ANLJ4KBN.js";import"./chunk-ID6SFQTL.js";import"./chunk-VLPNAR64.js";import"./chunk-GE5NEIZC.js";import{e as l}from"./chunk-35CVRQTC.js";var u=function(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds},d=new c,f=a.packedLength+c.packedLength,h=a.packedLength+2,p=a.packedLength+c.packedLength,m=c.packedLength+1,b={modelMatrix:new a,boundingVolume:new s};function k(e,t){let n=t*f,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=Math.sqrt(3),b}function g(e,t){let n=t*h,r=e[n++],o=e[n++],i=c.fromElements(r,r,o,d),s=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(s,i,s);let l=b.boundingVolume;return c.clone(c.ZERO,l.center),l.radius=Math.sqrt(2),b}function I(e,t){let n=t*p,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=1,b}function y(e,t){let n=t*m,r=e[n++],o=c.unpack(e,n,d),i=a.fromTranslation(o,b.modelMatrix);a.multiplyByUniformScale(i,r,i);let s=b.boundingVolume;return c.clone(c.ZERO,s.center),s.radius=1,b}var x=new c;function A(t,n,r,o,i){if(!l(n))return;let d=r.length,f=o.attributes.position.values,h=o.indices,p=t.positions,m=t.vertexBatchIds,b=t.indices,k=t.batchIds,g=t.batchTableColors,I=t.batchedIndices,y=t.indexOffsets,A=t.indexCounts,B=t.boundingVolumes,w=t.modelMatrix,j=t.center,L=t.positionOffset,v=t.batchIdIndex,O=t.indexOffset,E=t.batchedIndicesOffset;for(let t=0;t<d;++t){let o=i(n,t),l=o.modelMatrix;a.multiply(w,l,l);let d=r[t],U=f.length;for(let e=0;e<U;e+=3){let t=c.unpack(f,e,x);a.multiplyByPoint(l,t,t),c.subtract(t,j,t),c.pack(t,p,3*L+e),m[v++]=d}let M=h.length;for(let e=0;e<M;++e)b[O+e]=h[e]+L;let C=t+E;I[C]=new u({offset:O,count:M,color:e.fromRgba(g[d]),batchIds:[d]}),k[C]=d,y[C]=O,A[C]=M,B[C]=s.transform(o.boundingVolume,l),L+=U/3,O+=M}t.positionOffset=L,t.batchIdIndex=v,t.indexOffset=O,t.batchedIndicesOffset+=d}var B=new c,w=new a,j=r(function(r,u){let d,f,h=l(r.boxes)?new Float32Array(r.boxes):void 0,p=l(r.boxBatchIds)?new Uint16Array(r.boxBatchIds):void 0,m=l(r.cylinders)?new Float32Array(r.cylinders):void 0,b=l(r.cylinderBatchIds)?new Uint16Array(r.cylinderBatchIds):void 0,x=l(r.ellipsoids)?new Float32Array(r.ellipsoids):void 0,j=l(r.ellipsoidBatchIds)?new Uint16Array(r.ellipsoidBatchIds):void 0,L=l(r.spheres)?new Float32Array(r.spheres):void 0,v=l(r.sphereBatchIds)?new Uint16Array(r.sphereBatchIds):void 0,O=l(h)?p.length:0,E=l(m)?b.length:0,U=l(x)?j.length:0,M=l(L)?v.length:0,C=o.getUnitBox(),F=t.getUnitCylinder(),S=n.getUnitEllipsoid(),T=C.attributes.position.values,V=F.attributes.position.values,N=S.attributes.position.values,R=T.length*O;R+=V.length*E+N.length*(U+M);let P=C.indices,Z=F.indices,J=S.indices,Q=P.length*O;Q+=Z.length*E+J.length*(U+M);let W=new Float32Array(R),Y=new Uint16Array(R/3),D=i.createTypedArray(R/3,Q),G=O+E+U+M,K=new Uint16Array(G),H=Array(G),q=new Uint32Array(G),X=new Uint32Array(G),_=Array(G);d=new Float64Array(r.packedBuffer),f=0,c.unpack(d,f,B),f+=c.packedLength,a.unpack(d,f,w);let z={batchTableColors:new Uint32Array(r.batchTableColors),positions:W,vertexBatchIds:Y,indices:D,batchIds:K,batchedIndices:H,indexOffsets:q,indexCounts:X,boundingVolumes:_,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:w,center:B};A(z,h,p,C,k),A(z,m,b,F,g),A(z,x,j,S,I),A(z,L,v,S,y);let $=function(t,n,r){let o=r.length,i=new Float64Array(2+o*s.packedLength+1+function(t){let n=t.length,r=0;for(let o=0;o<n;++o)r+=e.packedLength+3+t[o].batchIds.length;return r}(n)),a=0;i[a++]=t,i[a++]=o;for(let e=0;e<o;++e)s.pack(r[e],i,a),a+=s.packedLength;let c=n.length;i[a++]=c;for(let t=0;t<c;++t){let r=n[t];e.pack(r.color,i,a),a+=e.packedLength,i[a++]=r.offset,i[a++]=r.count;let o=r.batchIds,s=o.length;i[a++]=s;for(let e=0;e<s;++e)i[a++]=o[e]}return i}(D.BYTES_PER_ELEMENT,H,_);return u.push(W.buffer,Y.buffer,D.buffer),u.push(K.buffer,q.buffer,X.buffer),u.push($.buffer),{positions:W.buffer,vertexBatchIds:Y.buffer,indices:D.buffer,indexOffsets:q.buffer,indexCounts:X.buffer,batchIds:K.buffer,packedBuffer:$.buffer}});export{j as default};